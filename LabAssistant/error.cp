#include "error.h"#include "lab assistant.h"void DoError(Str255 theMessage, Boolean Fatal){	if(Fatal)		NewAlert(theMessage, false);	NewAlert(theMessage, false);}short NewAlert(Str255 theMessage, Boolean cancelButton, short defaultItem, short theIcon){	DialogPtr		theDialog;	WindowPtr		oldPort;	short			dialogItemHit;	Boolean			dialogDone = false;	short			itemType;	Handle			itemHandle;	Rect			itemRect;	CIconHandle		iconHandle;		GetPort(&oldPort);		theDialog = GetNewDialog(kGeneralAlertBoxID, nil, (WindowPtr) -1L);		ParamText(theMessage, kEmptyString, kEmptyString, kEmptyString);		SetPort(theDialog);		if(!cancelButton)		HideDItem(theDialog, cancel);		iconHandle = GetCIcon(theIcon);		GetDItem(theDialog, 4, &itemType, &itemHandle, &itemRect);	SetDItem(theDialog, 4, itemType, (Handle) iconHandle, &itemRect);	DisposCIcon((CIconHandle) itemHandle);			SetDialogDefaultItem(theDialog, defaultItem);		if(cancelButton)		SetDialogCancelItem(theDialog, defaultItem == ok ? cancel : ok);		ShowWindow(theDialog);		SysBeep(5);		while (!dialogDone)	{		ModalDialog(TheDialogFilter, &dialogItemHit);				switch (dialogItemHit)		{			case ok:			case cancel:				DisposeDialog(theDialog);				SetPort(oldPort);				return dialogItemHit;				break;		}	}		return dialogItemHit;}Boolean TheDrawProc(WindowPtr theWindow){	Boolean 	returnValue = false;	long		refCon = GetWRefCon(theWindow);	WindowPtr	oldPort;		switch(refCon)	{		case kMainWindow:			GetPort(&oldPort);			SetPort(theWindow);			BeginUpdate(theWindow);			//DrawWindowContents();			EndUpdate(theWindow);			SetPort(oldPort);			break;		default:			returnValue = false;			break;	}		return returnValue;}pascal Boolean TheDialogFilter(DialogPtr theDialog, EventRecord *theEvent, short *theItem){	Boolean			returnValue = false;	WindowPtr		oldPort;	ModalFilterUPP	theProc;		if((WindowPtr) theEvent->message != theDialog && theEvent->what == updateEvt)	{		returnValue = TheDrawProc((WindowPtr) theEvent->message);	}	else	{		GetPort(&oldPort);		SetPort(theDialog);				GetStdFilterProc(&theProc);				returnValue = theProc(theDialog, theEvent, theItem);				SetPort(oldPort);	}		return returnValue;	}